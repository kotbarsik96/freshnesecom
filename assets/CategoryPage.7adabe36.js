import{_ as B,C,g as y,i as g,j as m,k as u,D as T,E as N,l as c,q as d,u as f,S as O,G as b,H as R,I,F as _,v as P,x,B as F,s as v,t as A,m as L,f as E,J as M,K as z}from"./index.d09eb5c6.js";import{c as H}from"./breadcrumbs.f9af167a.js";import{p as k}from"./page-controls.500bb39b.js";const D={name:"RangeBlock",props:{name:{type:String,default:"range-block"},min:{type:Number,default:0},max:{type:Number,default:1e3},minValue:Number,maxValue:Number},emits:["initialized","update:minValue","update:maxValue"],data(){return{numberValues:{min:this.min,max:this.max},togglerPositions:{min:0,max:0},initialized:!1,rangeData:{}}},computed:{barWidth(){return this.togglerPositions.max-this.togglerPositions.min},step(){return this.max/this.rangeData.widthLimit}},methods:{resetRangeBlock(){this.setToggler("max",this.rangeData.widthLimit),this.setToggler("min",0)},setNumberValues(e=null,t=null){const i=e>=0&&e<=t&&e>=this.min,a=t>=0&&t>=e&&t<=this.max;console.log(i,a),i&&(this.numberValues.min=e),a&&(this.numberValues.max=t)},initRangeBlock(){this.getRangeData(),this.setToggler("max",this.rangeData.widthLimit),this.initialized=!0,this.$emit("initialized")},setToggler(e,t){const i=this.$refs[`toggler${e}`];t=this.preventTogglerTrespass(t),t=this.preventTogglerCollision(t,e),i.style.left=`${t}px`,this.togglerPositions[e]=t},getRangeData(){const e=this.$refs.range,t=e.offsetWidth,i=t-this.$refs.togglermin.offsetWidth,a=C(e);this.rangeData={width:t,widthLimit:i,coords:a}},grabClosestToggler(e){const t=this.rangeData.coords;let i=Math.round(e.x-t.left)-this.$refs.togglermin.offsetWidth/2;const a=this.togglerPositions.min,n=this.togglerPositions.max,s=Math.abs(a-i)<Math.abs(n-i)?"min":"max",l=this.$refs[`toggler${s}`];this.setToggler(s,i),this.onPointerdown(s,e,l)},onPointerdown(e,t,i=null){i||(i=t.target);const a=this.rangeData.coords,n=l=>{let r=Math.round(l.x-a.left)-i.offsetWidth/2;r=this.preventTogglerTrespass(r),r=this.preventTogglerCollision(r,e),i.style.left=`${r}px`,this.togglerPositions[e]=r},s=()=>{document.removeEventListener("pointermove",n),document.removeEventListener("pointerup",s)};document.addEventListener("pointermove",n),document.addEventListener("pointerup",s)},preventTogglerTrespass(e){const t=this.rangeData.widthLimit;return e<0?0:e>t?t:e},preventTogglerCollision(e,t){const i=this.togglerPositions.min,a=this.togglerPositions.max;return t==="min"&&e>a?a:t==="max"&&e<i?i:e},onNumbersChange(){const e=this.numberValues.min/this.step,t=this.numberValues.max/this.step;this.$nextTick().then(()=>{this.setToggler("min",e),this.setToggler("max",t)})},onTogglersMove(){const e=Math.round(this.togglerPositions.min*this.step),t=Math.round(this.togglerPositions.max*this.step);this.numberValues={min:e,max:t},this.$nextTick().then(()=>{this.$refs.inputMin.value=e,this.$refs.inputMax.value=t})},onValueChange(e="inputs"){switch(e){case"inputs":default:this.onNumbersChange();break;case"togglers":this.onTogglersMove();break}this.$nextTick().then(()=>{this.$emit("update:minValue",this.numberValues.min),this.$emit("update:maxValue",this.numberValues.max)})}},watch:{numberValues:{handler(){this.onValueChange("inputs")},deep:!0},togglerPositions:{handler(){this.onValueChange("togglers")},deep:!0},min(){this.initRangeBlock()},max(){this.initRangeBlock()}},mounted(){this.$nextTick().then(this.initRangeBlock),window.addEventListener("resize",this.initRangeBlock),document.addEventListener("pageAnimationEnd",this.initRangeBlock)},unmounted(){window.removeEventListener("resize",this.initRangeBlock),document.removeEventListener("pageAnimationEnd",this.initRangeBlock)}},S=["name"],W={class:"range-block__range",ref:"range"},U={class:"range-block__values"},j=u("span",{class:"range-block__values-delimeter"},"-",-1);function q(e,t,i,a,n,s){const l=y("InputText"),r=y("InputWrapper");return g(),m("div",{class:"range-block",name:i.name},[u("div",W,[u("div",{class:"range-block__toggler range-block__toggler--left",ref:"togglermin",onPointerdown:t[0]||(t[0]=T(o=>s.onPointerdown("min",o),["prevent"]))},null,544),u("div",{class:"range-block__scale",onPointerdown:t[1]||(t[1]=T((...o)=>s.grabClosestToggler&&s.grabClosestToggler(...o),["prevent"]))},[u("div",{class:"range-block__bar",style:N({width:`${s.barWidth}px`,left:`${n.togglerPositions.min}px`})},null,4)],32),u("div",{class:"range-block__toggler range-block__toggler--right",ref:"togglermax",onPointerdown:t[2]||(t[2]=T(o=>s.onPointerdown("max",o),["prevent"]))},null,544)],512),u("div",U,[c(r,null,{label:d(()=>[f("\u041E\u0442")]),default:d(()=>[c(l,{type:"number",name:i.name,placeholder:n.numberValues.min.toString(),minNumber:i.min,maxNumber:n.numberValues.max,ref:"inputMin",modelValue:n.numberValues.min,"onUpdate:modelValue":t[3]||(t[3]=o=>n.numberValues.min=o)},null,8,["name","placeholder","minNumber","maxNumber","modelValue"])]),_:1}),j,c(r,null,{label:d(()=>[f("\u0414\u043E")]),default:d(()=>[c(l,{type:"number",name:i.name,placeholder:n.numberValues.max.toString(),minNumber:n.numberValues.min,maxNumber:i.max,ref:"inputMax",modelValue:n.numberValues.max,"onUpdate:modelValue":t[4]||(t[4]=o=>n.numberValues.max=o)},null,8,["name","placeholder","minNumber","maxNumber","modelValue"])]),_:1})])],8,S)}var Q=B(D,[["render",q]]);const $={name:"ListFilter",components:{RangeBlock:Q,StarRating:O},props:{array:{type:Array,required:!0},fields:{type:Array,required:!0},isHideable:{type:Boolean,default:!1},name:{type:String,default:"filter"},modelValue:Array},emits:["update:modelValue"],data(){return{fieldOptions:{}}},computed:{isRangeBlocksInitialized(){return!this.fields.filter(i=>i.type==="range").map(i=>i.key).map(i=>this.fieldOptions[i]?Boolean(this.fieldOptions[i].initialized):!1).includes(!1)},isFilterInitialized(){return this.isRangeBlocksInitialized&&this.$refs.checkInputsFB}},methods:{getFilterFields(){this.$nextTick().then(()=>{this.fieldOptions={};for(let e of this.fields){let i=function(s){if(!t.find(l=>l.value==s)){const l=this.getOptionTitle(s,e),r={value:s,valueTitle:l};t.push(r)}},a=function(s){for(let l in s){const r=s[l];r&&(typeof r=="object"?a(r):i(r))}},n=function(s){i(!!s)};i=i.bind(this);const t=[];if(e.type==="checkbox"||e.type==="radio"){for(let s of this.array){const l=b(e.key,s);typeof l=="object"?a(l):e.booleanOnly?n(l):i(l)}e.type==="radio"&&t.length<2?this.fieldOptions[e.key]=[]:this.fieldOptions[e.key]=t}if(e.type==="range"){let s=this.fieldOptions[e.key];s||(this.fieldOptions[e.key]={},s=this.fieldOptions[e.key]),s.min=e.rangeValues.min,s.max=e.rangeValues.max,this.initRangeBlock(e.key)}}})},getOptionTitle(e,t){if(typeof e=="boolean"||e.booleanOnly){const i=t.booleanTitles||{forTrue:"\u0414\u0430",forFalse:"\u041D\u0435\u0442"};return e?i.forTrue||"\u0414\u0430":i.forFalse||"\u041D\u0435\u0442"}return e},getFilterBlockRef(e){switch(e){case"checkbox":case"radio":return"checkInputsFB";case"range":return"rangeBlockFB"}},getRangeValue(e,t,i){const a=this.fieldOptions[i];a&&(a[t]=e)},isFieldOption(e){const t=this.fieldOptions[e];return t?Array.isArray(t)?t.length>0:!0:!1},initRangeBlock(e=null){const t=this.$refs.rangeBlock;if(i=i.bind(this),t){if(e)return i(e);this.fields.filter(n=>n.type==="range").map(n=>n.key).forEach(n=>i(n))}function i(a){if(t.find(s=>s.name===a).initialized){const s=this.fieldOptions[a];s?s.initialized=!0:this.fieldOptions[a]={initialized:!0}}}},applyFilter(){if(!this.isFilterInitialized){this.$nextTick().then(()=>{setTimeout(this.applyFilter,100)});return}let e=[...this.array];t.call(this),i.call(this),this.$emit("update:modelValue",e);function t(){const a=this.$refs.checkInputsFB;for(let n of a){const s=Array.from(n.querySelectorAll("input:checked")),l=this.fields.find(o=>o.key===n.dataset.filterFieldKey),r=s.map(o=>o.value).map(o=>o=="true"?!0:o=="false"?!1:o);r.length>0&&(e=e.filter(o=>{const h=b(l.key,o);if(l.booleanOnly)return r.map(w=>Boolean(w)).includes(Boolean(h));const V=typeof h=="object"?R(r,h):!1;return!!(r.includes(h)||V)}))}}function i(){this.fields.filter(n=>n.type==="range").forEach(n=>{const s=this.fieldOptions[n.key].min,l=this.fieldOptions[n.key].max;e=e.filter(r=>{const o=b(n.key,r);return o>=s&&o<=l})})}},reset(){const e=this.$refs.checkInput,t=this.$refs.rangeBlock;e.forEach(i=>{i.checked=!1,i.dispatchEvent(new Event("change"))}),t.forEach(i=>i.resetRangeBlock()),this.applyFilter()}},watch:{fields:{handler(){this.getFilterFields()},deep:!0}},created(){this.getFilterFields()},mounted(){const e=this.$refs;I(e.fHeader,e.fBody),this.applyFilter()}},J=["data-hideable"],G={class:"list-filter__header",ref:"fHeader"},K=u("h3",{class:"list-filter__title __icon-chevron-top_bottom"},"\u0424\u0438\u043B\u044C\u0442\u0440",-1),Y=[K],Z={class:"list-filter__body",ref:"fBody"},X=["data-filter-field-key"],ee={class:"list-filter__block-title"},te={class:"list-filter__block-options"},ie=["type","name","value"],se={class:"list-filter__btns"};function ne(e,t,i,a,n,s){const l=y("RangeBlock");return g(),m("div",{class:"list-filter","data-hideable":i.isHideable},[u("div",G,Y,512),u("div",Z,[(g(!0),m(_,null,P(i.fields,r=>(g(),m(_,{key:r.key},[s.isFieldOption(r.key)?(g(),m("div",{key:0,class:"list-filter__block",ref_for:!0,ref:s.getFilterBlockRef(r.type),"data-filter-field-key":r.key},[u("h4",ee,x(r.title),1),u("div",te,[r.type==="checkbox"||r.type==="radio"?(g(!0),m(_,{key:0},P(n.fieldOptions[r.key],(o,h)=>(g(),m("label",{class:"list-filter__block-option",key:h},[u("input",{type:r.type,name:`${i.name}-${r.key.split(".")[0]}`,value:o.value,ref_for:!0,ref:"checkInput"},null,8,ie),u("span",{class:F([r.type])},x(o.valueTitle),3)]))),128)):v("",!0),r.type==="range"?(g(),A(l,{key:1,name:r.key,min:r.rangeValues.min,max:r.rangeValues.max,ref_for:!0,ref:"rangeBlock",onInitialized:o=>s.initRangeBlock(r.key),"onUpdate:minValue":o=>s.getRangeValue(o,"min",r.key),"onUpdate:maxValue":o=>s.getRangeValue(o,"max",r.key)},null,8,["name","min","max","onInitialized","onUpdate:minValue","onUpdate:maxValue"])):v("",!0)])],8,X)):v("",!0)],64))),128)),u("div",se,[u("button",{class:"list-filter__button button--colored",onClick:t[0]||(t[0]=(...r)=>s.applyFilter&&s.applyFilter(...r))}," \u041F\u0440\u0438\u043C\u0435\u043D\u0438\u0442\u044C "),u("button",{class:"list-filter__button button--transparent",onClick:t[1]||(t[1]=(...r)=>s.reset&&s.reset(...r))}," \u0421\u0431\u0440\u043E\u0441\u0438\u0442\u044C ")])],512)],8,J)}var re=B($,[["render",ne]]);const ae={name:"CategoryPage",components:{ListFilter:re},data(){return{viewType:"list",filterFields:[],filteredProducts:[],pageRouteName:"category-pagenumber",mediaQueries:{889:!1,1129:!1}}},emits:["breadcrumbs-change"],computed:{...L(["categories","products"]),categoryId(){return this.$route.params.categoryId},category(){if(this.$route.name.includes("category"))return this.getRouteParamOrNotFound(this.categoryId,this.categories,"id")},productCardComponent(){if(this.viewType==="grid")return"ProductCard";if(this.viewType==="list")return"ProductCardBig"},maxCardsOnPage(){switch(this.viewType){case"list":default:return 3;case"grid":return 6}},pageRouteTitle(){return this.category?this.category.title:""},categoryProducts(){return this.products.filter(e=>e.category===this.categoryId)},isFilterHideable(){const e=this.mediaQueries[889],t=this.mediaQueries[1129];return!!(this.viewType==="grid"&&e||this.viewType==="list"&&t)},pagesArray(){const e=this.filteredProducts.map(i=>i.id),t=this.maxCardsOnPage;return k.computed.createPagesArray(e,t)},pagesAmount:k.computed.pagesAmount,pageNumber:k.computed.pageNumber},methods:{...E(["loadJsonFile"]),mediaQueriesHandlers:M,getRouteParamOrNotFound:z,createBreadcrumbs:H,stateFilterFields(){const e={price:{},"rating.value":{}};for(let t in e){const i=this.categoryProducts.map(a=>{const n=b(t,a);return typeof n=="number"?n:null}).filter(a=>a);e[t].min=0,e[t].max=Math.ceil(Math.max(...i))}this.filterFields=[{title:"\u041A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u044F",key:"subcategory",type:"checkbox"},{title:"\u0420\u0435\u0439\u0442\u0438\u043D\u0433",key:"rating.value",type:"range",rangeValues:e["rating.value"]},{title:"\u0412 \u043D\u0430\u043B\u0438\u0447\u0438\u0438",key:"stock",type:"radio",booleanTitles:{forTrue:"\u0412 \u043D\u0430\u043B\u0438\u0447\u0438\u0438",forFalse:"\u041D\u0435\u0442 \u0432 \u043D\u0430\u043B\u0438\u0447\u0438\u0438"}},{title:"\u0421\u043A\u0438\u0434\u043A\u0430",key:"oldPrice",type:"radio",booleanOnly:!0,booleanTitles:{forTrue:"\u0415\u0441\u0442\u044C"}},{title:"\u0426\u0435\u043D\u0430",key:"price",type:"range",rangeValues:e.price}]},checkRoutePageNumber(){this.categoryId&&k.methods.checkRoutePageNumber.call(this)},setPage:k.methods.setPage},watch:{categoryProducts(){this.stateFilterFields()},pageRouteTitle(){this.createBreadcrumbs()},pageNumber:k.watch.pageNumber,pagesArray:k.watch.pagesArray},created(){this.loadJsonFile("products"),this.createBreadcrumbs()},mounted(){this.mediaQueriesHandlers()}},oe={class:"category-page"},le={class:"tag--colored"},ue={class:"category-page__content"};function ce(e,t,i,a,n,s){const l=y("PageHeadlineItem"),r=y("PageHeadline"),o=y("ListFilter"),h=y("RouterView"),V=y("PaginationControls");return g(),m("main",oe,[s.category?(g(),m(_,{key:0},[c(r,{class:"container"},{title:d(()=>[f(x(s.category.title),1)]),default:d(()=>[c(l,{iconName:"layout-sections",isActive:n.viewType==="list",isControl:"",onClick:t[0]||(t[0]=p=>n.viewType="list")},{default:d(()=>[f("\u0421\u043F\u0438\u0441\u043E\u043A")]),_:1},8,["isActive"]),c(l,{iconName:"layout-square_grid",isActive:n.viewType==="grid",isControl:"",onClick:t[1]||(t[1]=p=>n.viewType="grid")},{default:d(()=>[f("\u0421\u0435\u0442\u043A\u0430")]),_:1},8,["isActive"]),c(l,null,{default:d(()=>[f(" \u041F\u0440\u043E\u0434\u0443\u043A\u0442\u043E\u0432: "),u("span",le,x(n.filteredProducts.length),1)]),_:1})]),_:1}),u("section",ue,[u("div",{class:F(["category-page__container",{"category-page__content--list-view":n.viewType==="list","category-page__content--grid-view":n.viewType==="grid"}])},[c(o,{class:"category-page__filter",isHideable:s.isFilterHideable,array:s.categoryProducts,modelValue:n.filteredProducts,"onUpdate:modelValue":t[2]||(t[2]=p=>n.filteredProducts=p),fields:n.filterFields},null,8,["isHideable","array","modelValue","fields"]),c(h,{class:"category-page__cards",prodcardClassName:"category-page__cards-item",viewType:n.viewType,prodIdsList:s.pagesArray[s.pageNumber-1]},null,8,["viewType","prodIdsList"])],2)]),c(V,{class:"container",list:n.filteredProducts,pagesAmount:s.pagesAmount,pageNumber:s.pageNumber,onPageNumberClick:t[3]||(t[3]=p=>s.setPage(p)),onNextButtonClick:t[4]||(t[4]=p=>s.setPage(s.pageNumber+1)),onPrevButtonClick:t[5]||(t[5]=p=>s.setPage(s.pageNumber-1))},{title:d(()=>[f("\u0421\u0442\u0440\u0430\u043D\u0438\u0446\u0430:")]),"pcs-title":d(()=>[f("\u041F\u0440\u043E\u0434\u0443\u043A\u0442\u043E\u0432")]),_:1},8,["list","pagesAmount","pageNumber"])],64)):v("",!0)])}var he=B(ae,[["render",ce]]);export{he as default};
